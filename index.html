<!DOCTYPE html>
<html>

<head>

	<title>Culturas Peruanas Pre-Incaicas</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="data:;base64,=">
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/Turf.js/5.1.5/turf.min.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet' />
	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="culture-general.js"></script>
	<script type="text/javascript" src="culture-sites.js"></script>


</head>


<body>

	<!-- MAP, TITLE, DROPDOWN and POPUP HERE -->


	<div id='map'>
		<div id='title'> Culturas Peruanas Pre-Incaicas</div>
		<div id="dropdown">
			<select id="select-menu">
				<option value="">All Groups</option>
			</select>
		</div>
	</div>


	<!-- BOTTOM MODULE v1 WITH CULTURES BOXES INITIAL SCREEN -->

	<div class= 'bottom-module-initial' id='bottomInitial'> 
		<div id='culture0' class='cultures'> 
			<h3 id='cultTitle0'>Caral</h3> 
			<p class="box-dates" id='boxDates0'>100 a.c. - 200a.c  </p> 
			<img src="images/huaca_prieta.jpg" width=200px>
		</div>
		<div id='culture1' class='cultures'> 
			<h3 id='cultTitle1'>Chavin</h3> 
			<p class="box-dates" id='boxDates1'>100 a.c. - 200a.c </p> 
			<img src="images/sechin.jpg" width=200px>
		</div>
		<div id='culture2' class='cultures'> 
			<h3 id='cultTitle2'>Recuay</h3> 
			<p class="box-dates" id='boxDates2'>100 a.c. - 200a.c </p> 
			<img src="images/aldas.png" width=200px>
		</div>
		<div id='culture3' class='cultures'> 
			<h3 id='cultTitle3'>Paracas</h3> 
			<p class="box-dates" id='boxDates3'>100 a.c. - 200a.c </p> 
			<img src="images/el_paraiso.jpg" width=200px>
		</div>
		<div id='culture4' class='cultures'> 
			<h3 id='cultTitle4'>Moche</h3> 
			<p class="box-dates" id='boxDates4'>100 a.c. - 200a.c </p> 
			<img src="images/badurria.jpg" width=200px>
		</div>
		<div id='culture5' class='cultures'> 
			<h3 id='cultTitle5'>Chimu</h3> 
			<p class="box-dates" id='boxDates5'>100 a.c. - 200a.c </p> 
			<img src="images/kotosh.jpg" width=200px>
		</div>
		<div id='culture6' class='cultures'> 
			<h3 id='cultTitle6'>Paracas</h3> 
			<p class="box-dates" id='boxDates6'>100 a.c. - 200a.c </p> 
			<img src="images/el_paraiso.jpg" width=200px>
		</div>
		<div id='culture7' class='cultures'> 
			<h3 id='cultTitle7'>Moche</h3> 
			<p class="box-dates" id='boxDates7'>100 a.c. - 200a.c </p> 
			<img src="images/badurria.jpg" width=200px>
		</div>
		<div id='culture8' class='cultures'> 
			<h3 id='cultTitle8'>Chimu</h3> 
			<p class="box-dates" id='boxDates8'>100 a.c. - 200a.c </p> 
			<img src="images/kotosh.jpg" width=200px>
		</div>
		<div id='culture9' class='cultures'> 
			<h3 id='cultTitle9'>Paracas</h3> 
			<p class="box-dates" id='boxDates9'>100 a.c. - 200a.c </p> 
			<img src="images/el_paraiso.jpg" width=200px>
		</div>
		<div id='culture10' class='cultures'> 
			<h3 id='cultTitle10'>Moche</h3> 
			<p class="box-dates" id='boxDates10'>100 a.c. - 200a.c </p> 
			<img src="images/badurria.jpg" width=200px>
		</div>
		<div id='culture11' class='cultures'> 
			<h3 id='cultTitle11'>Chimu</h3> 
			<p class="box-dates" id='boxDates11'>100 a.c. - 200a.c </p> 
			<img src="images/kotosh.jpg" width=200px>
		</div>
		<div id='culture12' class='cultures'> 
			<h3 id='cultTitle12'>Paracas</h3> 
			<p class="box-dates" id='boxDates12'>100 a.c. - 200a.c </p> 
			<img src="images/el_paraiso.jpg" width=200px>
		</div>
		<div id='culture13' class='cultures'> 
			<h3 id='cultTitle13'>Moche</h3> 
			<p class="box-dates" id='boxDates13'>100 a.c. - 200a.c </p> 
			<img src="images/badurria.jpg" width=200px>
		</div>

	</div> 

	<!-- BOTTOM MODULE v2 WITH SPECIFIC CULTURE ONCE SELECTED -->

	<div id='bottomCulture' class= 'bottom-module hidden'> 
		<div class="first-box">
			<h1 id="culture-title">
				Here title
			</h1>
			<p id="culture-dates" class="info-culture">
				Here dates 
			</p>
			<p id="culture-period" class="info-culture">
				Historical Period
			</p>
		</div>
		<div class="second-box">
			<p id="culture-description">
				Description goes here
			</p>
			<a id="culture-link" href="https://en.wikipedia.org/wiki/Huaca_Prieta" target="_blank">			Learn more
			</a>
		</div>
		<div class="third-box">
			<img id="culture-photo" src="images/huaca_prieta.jpg" width=auto>
		</div>

	</div>

	<!-- RIGHT MODULE ARCHEO -->

	<div class= 'right-module' id='archeo-sites'> 
		<img id="archeo-photo" src="images/huaca_prieta.jpg" width=300px>
		<button id="closeButton"> close 
		</button>
		<h2 id="archeo-name"> 
			NAME HERE
		</h2>
		<p class="right-description" id="archeo-description">
				Here a lot of text, text, text, text. 
		</p>
		<a id="archeo-link" href="https://en.wikipedia.org/wiki/Huaca_Prieta" target="_blank">				Learn more
		</a>
	</div>




	<script type="text/javascript">




//MAPBOX ACCESS	AND BASELINE MAP STYLE	
		mapboxgl.accessToken = 'pk.eyJ1IjoiYWxlb3JhMjk2IiwiYSI6ImNrMmttaDlzMDIzeHAzaHE4NnMyamp0eHkifQ.ufBrm_31R6oudOYvQfwgjQ';

		var map = new mapboxgl.Map({
			container: 'map', 
			style: 'mapbox://styles/aleora296/ck8t1mzkq038n1io13n9727rg', 
			center: [-7.924008, -89.306949],
			zoom: 20
		});


//LOADS THE DATA
		map.on('load', function () {
			for (let i = 0; i < cultureGeneral.features.length; i++) {
				cultureGeneral.features[i]['id'] = i + 1
			}

			for (let i = 0; i < cultureSites.features.length; i++) {
				cultureSites.features[i]['id'] = i + 1
			}


//STYLE FOR LAYER			
			datalayer = map.addLayer({
				id: "datalayer",
				type: "circle",
				source: {
					type: "geojson",
					data: cultureGeneral,
				},
				minzoom:3,
				maxzoom:5,
				paint: {
					'circle-radius': ['to-number', ['get', 'radius']],
					'circle-stroke-color': 'white',
					'circle-stroke-width': 2,
					'circle-color': [
						'case',
						['boolean', ['feature-state', 'hover'], false],
						'#666',
						['get', 'color'],
					],
					'circle-opacity': [
						'case',
						['boolean', ['feature-state', 'hover'], false],
						1,
						0.5
					]
				}
		
			});

			datalayer1 = map.addLayer({
				id: "datalayer1",
				type: "circle",
				source: {
					type: "geojson",
					data: cultureSites,
				},
				minzoom:5,
				maxzoom:20,
				//layout: {
				//	'visibility' : 'none',
				//},
				paint: {
					'circle-radius': ['to-number', ['get', 'radius']],
					'circle-stroke-color': 'white',
					'circle-stroke-width': 2,
					'circle-color': [
						'case',
						['boolean', ['feature-state', 'hover'], false],
						'#666',
						['get', 'color'],
					],
					'circle-opacity': [
						'case',
						['boolean', ['feature-state', 'hover'], false],
						1,
						0.5
					]
				}
		
			});



//ADD NAVIGATION BAR
		map.addControl(new mapboxgl.NavigationControl(), 'bottom-left');

// CONTROLS THE POPUP
		var popup = new mapboxgl.Popup({ 
			closeButton: false, 
			closeOnClick: false });


		let hoverCurrentId = null 
		var datalayer;

		function startHover(e) {
			let feature = e.features[0]

			if (hoverCurrentId) {
				map.setFeatureState({ source: 'datalayer', id: hoverCurrentId }, { hover: false });
			}
			hoverCurrentId = feature.id
			map.setFeatureState({ source: 'datalayer', id: hoverCurrentId }, { hover: true });
		}

		function stopHover(e) {
			if (hoverCurrentId) {
				map.setFeatureState({ source: 'datalayer', id: hoverCurrentId }, { hover: false });
			}
			hoverCurrentId = null;
		}

// DECLARING FUNCTION POPUP FOR CULTURE GENERAL OBJECT
		function drawPopupGeneral(e) {
			let feature = e.features[0]
			map.getCanvas().style.cursor = 'pointer';

			var coordinates = feature.geometry.coordinates.slice();
			var placeName = feature.properties.name;

			while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
				coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
			}

			popup.setLngLat(coordinates)
				.setHTML(placeName)
				.addTo(map);
		}

// DECLARING FUNCTION POPUP FOR CULTURE ARCHEO SITES OBJECT
		function drawPopupSites(e) {
			let feature = e.features[0]
			map.getCanvas().style.cursor = 'pointer';

			var coordinates = feature.geometry.coordinates.slice();
			var placeName = feature.properties.site_name;

			while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
				coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
			}

			popup.setLngLat(coordinates)
				.setHTML(placeName)
				.addTo(map);
		}

		function removePopup(e) {
			map.getCanvas().style.cursor = '';
			popup.remove();
		}


// CALLING POP UP GENERAL CULTURE
			// draws the popup and changes the hover style When moving the mouse over, 
			map.on('mouseenter', 'datalayer', function (e) {
				startHover(e)
				drawPopupGeneral(e)
			});

			// Turns off the hovering and popup when moving the mouse away from a point, 
			map.on('mouseleave', 'datalayer', function (e) {
				stopHover(e)
 				removePopup(e)
			});


// CALLING POP UP ARCHEO SITES
			// draws the popup and changes the hover style When moving the mouse over, 
			map.on('mouseenter', 'datalayer1', function (e) {
				startHover(e)
				drawPopupSites(e)
			});

			// Turns off the hovering and popup when moving the mouse away from a point, 
			map.on('mouseleave', 'datalayer1', function (e) {
				stopHover(e)
 				removePopup(e)
			});

// UPDATE BOTTOM MODULE BASED ON CULTURE SELECTED

		function updateStory(e) {
			let feature = e.features[0]
		    var cultureName = feature.properties.name;
		   	var cultureStart = feature.properties.startDate;
		    var cultureEnd = feature.properties.endDate;
		    var culturePeriod = feature.properties.period;
		    var cultureText = feature.properties.description;

		    document.getElementById('culture-title').textContent = cultureName;
		    document.getElementById('culture-dates').textContent = cultureStart + " - " + cultureEnd;
		    document.getElementById('culture-period').textContent = culturePeriod;
		    document.getElementById('culture-description').textContent = cultureText;		    
		}


		function updateModule(e) {
			let feature = e.features[0]
			var siteName = feature.properties.site_name;
			var siteDescrip = feature.properties.type;
			var siteLink = feature.properties.link;

			$('#archeo-name').html(siteName)
			$('#archeo-description').html(siteDescrip)
			$('#archeo-link').html(siteLink)
	    
		}

			// This updates the bottom module on click
			map.on('click', 'datalayer', function (e) {
				document.getElementById('bottomCulture').classList.remove('hidden');
				document.getElementById('bottomInitial').classList.add('hidden');
				updateStory(e)

				
			});

			map.on('click', 'datalayer1', function (e) {
				updateModule(e)
				$('#archeo-sites').show(200);
				updateStory(cultureGeneral)
				
			});

// NEED HELP HERE	
// NEED HELP HERE
// NEED HELP HERE
// NEED HELP HERE
// NEED HELP HERE	


// CENTERS THE MAP BASED ON LAYER DATA

			map.fitBounds(turf.bbox(cultureGeneral), { 
				padding: 90, 
				linear: true 
			})
		});


$(document).ready(function () {
	$('#title').on('click',function() {

		map.fitBounds(turf.bbox(cultureGeneral), { 
				padding: 90, 
				linear: true 
			})

		$('#bottomCulture').addClass( "hidden" );
		$('#bottomInitial').removeClass( "hidden" );

		$('#archeo-sites').hide(200);


	});


		});


// INITIAL MODULE BOXES DISPLAY ON MAP DATA FROM SPECIFIC CULTURE
	for (var i = 0; i < cultureGeneral.features.length; i++){

		let activeCulture = i;

			$(document).ready(function () {
	
				$('#culture'+activeCulture).on('click',function() {

					var selectedGroup = $('#cultTitle'+activeCulture).text();
						
						if (!selectedGroup) {
							map.setFilter('datalayer1', null);
						} else {
							map.setFilter('datalayer1', ['==', ['get', 'name'], selectedGroup]);
						}


					$('#bottomCulture').removeClass( "hidden" );
					$('#bottomInitial').addClass( "hidden" );
					

		// INITIAL MODULE BOXES ZOOM IN BASED ON SPECIFIC CULTURE
					var bounds = new mapboxgl.LngLatBounds();

// NEED HELP HERE	
// NEED HELP HERE
// NEED HELP HERE
// NEED HELP HERE
// NEED HELP HERE				
					cultureSites.features.forEach(function(feature) {
					    bounds.extend(feature.geometry.coordinates);
					});

					map.fitBounds(bounds);

		// LOADING DATA OF SPECIFIC CULTURE FOR BOTTOM MODULE
			  		var cultureName = cultureGeneral.features[activeCulture].properties.name;
		      		var cultureStart = cultureGeneral.features[activeCulture].properties.startDate;
		      		var cultureEnd = cultureGeneral.features[activeCulture].properties.endDate;
		     		var culturePeriod = cultureGeneral.features[activeCulture].properties.period;
		      		var cultureText = cultureGeneral.features[activeCulture].properties.description;
		      		var cultureLink = cultureGeneral.features[activeCulture].properties.link;

					$('#culture-title').html(cultureName);
					$('#culture-dates').html(cultureStart + " - " + cultureEnd);
					$('#culture-period').html(culturePeriod);
					$('#culture-description').html(cultureText);
					$('#culture-link').html(cultureLink);

				});

			});

		}


/*

*/

//CHANGES THE DATA OF INITIAL AND CULTURE SCREENS

		for (var i = 0; i < cultureGeneral.features.length; i++){

			  var activeCulture = i;
		      var cultName = cultureGeneral.features[i].properties.name; // initial screen

		      var cultureName = cultureGeneral.features[i].properties.name; // culture screen
		      var cultureStart = cultureGeneral.features[i].properties.startDate;
		      var cultureEnd = cultureGeneral.features[i].properties.endDate;
		      var culturePeriod = cultureGeneral.features[i].properties.period;
		      var cultureText = cultureGeneral.features[i].properties.description;
		      var cultureLink = cultureGeneral.features[i].properties.link;

					$('#culture-title').html(cultureName);
					$('#culture-dates').html(cultureStart + " - " + cultureEnd);
					$('#culture-period').html(culturePeriod);
					$('#culture-description').html(cultureText);
					$('#culture-link').html(cultureLink);

					$('#cultTitle'+ activeCulture).html(cultName);
					$('#boxDates'+ activeCulture).html(cultureStart + " - " + cultureEnd);
}


//JQUERY FOR RIGHT MODULE

		$(document).ready(function () {

			$('#archeo-sites').css({
				display:'none'
			});

			$('#closeButton').on('click',function() {
				$('#archeo-sites').hide(200);
			});

		});



// JQUERY THAT CHANGES WHAT IS DATA IS DISPLAYED BASED ON DROPDOWN MENU

		var groupsObj = {};

		$(document).ready(function () {
			cultureSites.features.forEach(function (feature) {
				groupsObj[feature.properties.group_id] = feature.properties.name;
			})

//crea las etiquetas y se las añade al menu que antes no tenia opciones
			$.each(groupsObj, function (key, value) {
				$('#select-menu')
					.append($("<option></option>")
						.attr("value", value)
						.text(value));
			});

			$('#select-menu').change(function () {
				var selectedGroup = $('#select-menu').val();

				if (!selectedGroup) {
					map.setFilter('datalayer1', null);
				} else {
					map.setFilter('datalayer1', ['==', ['get', 'name'], selectedGroup]);
				}
			});
		});


	</script>




</body>

</html>